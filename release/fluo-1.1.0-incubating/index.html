<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" integrity="sha384-h21C2fcDk/eFsW9sC9h0dhokq5pDinLNklTKoxIZRUn3+hvmgQSffLLQ4G4l2eEr" crossorigin="anonymous">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/fluo.css">
    <link rel="canonical" href="https://fluo.apache.org//release/fluo-1.1.0-incubating/">
    <link rel="icon" type="image/png" href="/resources/favicon.png">
    
    <title>Apache Fluo 1.1.0-incubating | Apache Fluo</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <!-- Place your <script> tags here. -->

<script>window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));</script>

  </head>
  <body style="padding-top: 100px">
    <nav id="fluo-nav" class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <div class="navbar-toggle-wrapper visible-xs">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".js-navbar-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
          </div>
          <a href="/" class="navbar-brand"><img id="fluo-img" height="40px" src="/resources/fluo-logo-dark.png" alt="Apache Fluo"></a>
        </div>
        <div class="collapse navbar-collapse js-navbar-collapse" style="margin-top: 20px">
          <ul class="navbar-nav nav">
            <li><a href="/releases/">Releases</a></li>
            <li><a href="/tour/">Tour</a></li>
            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#">Docs<span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="/docs/fluo/1.2/">Fluo</a></li>
                <li><a href="/docs/fluo-recipes/1.2/">Fluo Recipes</a></li>
              </ul>
            </li>
            <li><a href="/api/">API</a></li>
            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#">Community<span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="/contactus/">Contact Us</a></li>
                <li><a href="/news/">News Archive</a></li>
                <li><a href="/people/">People</a></li>
                <li><a href="/related-projects/">Related Projects</a></li>
                <li><a href="/poweredby/">Powered By</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#">Contributing<span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="/how-to-contribute/">How To Contribute</a></li>
                <li><a href="/release-process/">Release Process</a></li>
              </ul>
            </li>
            <li><a href="/search/">Search</a></li>
          </ul>
          <ul class="navbar-nav nav navbar-right">
            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#"><img alt="Apache Software Foundation" src="https://www.apache.org/images/feather-small.png" width="70"/><span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="https://www.apache.org">Apache Homepage</a></li>
                <li><a href="https://www.apache.org/licenses/">License</a></li>
                <li><a href="https://www.apache.org/foundation/sponsorship">Sponsorship</i></a></li>
                <li><a href="https://www.apache.org/security">Security</a></li>
                <li><a href="https://www.apache.org/foundation/thanks">Thanks</a></li>
                <li><a href="https://www.apache.org/foundation/policies/conduct">Code of Conduct</a></li>
                <li><a href="https://www.apache.org/events/current-event.html">Current Event</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container">
      <div class="row">
          <div class="col-sm-12">
            <div class="post-header">
  <h2>Apache Fluo 1.1.0-incubating</h2>
  <p class="text-muted">12 Jun 2017</p>
  <p><a class="twitter-share-button" href="https://twitter.com/intent/tweet?text=Apache Fluo 1.1.0-incubating&url=https://fluo.apache.org//release/fluo-1.1.0-incubating/&via=ApacheFluo&related=ApacheFluo" rel="nofollow" target="_blank" title="Share on Twitter">Twitter</a></p>
</div>





<div class="post-content">
  <p>Below are resources for this release:</p>

<ul>
  <li>
    <p>Download a release tarball and verify by these <a href="https://www.apache.org/info/verification">procedures</a> using these <a href="https://www.apache.org/dist/incubator/fluo/KEYS">KEYS</a></p>

    <table>
      <tbody>
        <tr>
          <td><a href="https://archive.apache.org/dist/incubator/fluo/fluo/1.1.0-incubating/fluo-1.1.0-incubating-bin.tar.gz">fluo-1.1.0-incubating-bin.tar.gz</a></td>
          <td><a href="https://archive.apache.org/dist/incubator/fluo/fluo/1.1.0-incubating/fluo-1.1.0-incubating-bin.tar.gz.asc">ASC</a> <a href="https://archive.apache.org/dist/incubator/fluo/fluo/1.1.0-incubating/fluo-1.1.0-incubating-bin.tar.gz.md5">MD5</a> <a href="https://archive.apache.org/dist/incubator/fluo/fluo/1.1.0-incubating/fluo-1.1.0-incubating-bin.tar.gz.sha">SHA</a></td>
        </tr>
        <tr>
          <td><a href="https://archive.apache.org/dist/incubator/fluo/fluo/1.1.0-incubating/fluo-1.1.0-incubating-source-release.tar.gz">fluo-1.1.0-incubating-source-release.tar.gz</a></td>
          <td><a href="https://archive.apache.org/dist/incubator/fluo/fluo/1.1.0-incubating/fluo-1.1.0-incubating-source-release.tar.gz.asc">ASC</a> <a href="https://archive.apache.org/dist/incubator/fluo/fluo/1.1.0-incubating/fluo-1.1.0-incubating-source-release.tar.gz.md5">MD5</a> <a href="https://archive.apache.org/dist/incubator/fluo/fluo/1.1.0-incubating/fluo-1.1.0-incubating-source-release.tar.gz.sha">SHA</a></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>View the <a href="/docs/fluo/1.1.0-incubating/">documentation</a> for this release.</li>
  <li>Read the <a href="https://javadoc.io/doc/org.apache.fluo/fluo-api/1.1.0-incubating/">Javadocs</a>.</li>
</ul>

<p>Apache Fluo follows <a href="http://semver.org/">semver</a> for its API . The API consists
of everything under the <code class="highlighter-rouge">org.apache.fluo.api</code> package. Code outside of this
package can change at any time. If your project is using Fluo code that falls
outside of the API, then consider <a href="/getinvolved/">initiating a discussion</a>
about adding it to the API.</p>

<h2 id="significant-changes">Significant changes</h2>

<p>The major changes in 1.1.0 are highlighted here, for the complete list of changes, see the <a href="https://github.com/apache/incubator-fluo/milestone/5?closed=1">1.1.0
Milestone</a> on Github.</p>

<h3 id="new-api-for-configuring-observers">New API for configuring observers.</h3>

<p>The 1.0.0 API for providing Observers required configuring an Observer class for each observed
column.  This API was cumbersome to use and made using lambdas impossible.  For <a href="https://github.com/apache/incubator-fluo/issues/816">#816</a> a better API
was introduced.   The new API only requires configuring a single class that provides all Observers.
This single class can register lambdas to observe a column.  This new API makes writing Fluo
applications faster and easier.  Below is an example of using the new API to register two observers
that compute the number of URLs that reference a document.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppObserverProvider</span> <span class="kd">implements</span> <span class="n">ObserverProvider</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Column</span> <span class="n">DOC_CURR_COL</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Column</span><span class="o">(</span><span class="s">"doc"</span><span class="o">,</span> <span class="s">"curr"</span><span class="o">);</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Column</span> <span class="n">DOC_NEW_COL</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Column</span><span class="o">(</span><span class="s">"doc"</span><span class="o">,</span> <span class="s">"new"</span><span class="o">);</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Column</span> <span class="n">DOC_URL_CHANGE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Column</span><span class="o">(</span><span class="s">"doc"</span><span class="o">,</span> <span class="s">"urlChange"</span><span class="o">);</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Column</span> <span class="n">DOC_REF_COUNT_COL</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Column</span><span class="o">(</span><span class="s">"doc"</span><span class="o">,</span> <span class="s">"refCount"</span><span class="o">);</span>

  <span class="c1">// Each Fluo worker will call this method to create the observers it needs.</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">provide</span><span class="o">(</span><span class="n">Registry</span> <span class="n">registry</span><span class="o">,</span> <span class="n">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// This could be used to pass application specific configuration to observers. Its not used in</span>
    <span class="c1">// this example.</span>
    <span class="n">SimpleConfiguration</span> <span class="n">appConfig</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getAppConfiguration</span><span class="o">();</span>

    <span class="c1">// Register an observer that processes new content for a document.</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">forColumn</span><span class="o">(</span><span class="n">DOC_NEW_COL</span><span class="o">,</span> <span class="n">STRONG</span><span class="o">).</span><span class="na">useObserver</span><span class="o">(</span><span class="k">new</span> <span class="n">ContentObserver</span><span class="o">());</span>

    <span class="c1">// Register a lambda that processes notifications for the column DOC_URL_CHANGE.</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">forColumn</span><span class="o">(</span><span class="n">DOC_URL_CHANGE</span><span class="o">,</span> <span class="n">WEAK</span><span class="o">).</span><span class="na">useStrObserver</span><span class="o">((</span><span class="n">tx</span><span class="o">,</span> <span class="n">myUrl</span><span class="o">,</span> <span class="n">col</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>

      <span class="c1">// Compute the number of URLs that refer to this URL.</span>
      <span class="n">CellScanner</span> <span class="n">refScanner</span> <span class="o">=</span> <span class="n">tx</span><span class="o">.</span><span class="na">scanner</span><span class="o">().</span><span class="na">over</span><span class="o">(</span><span class="n">Span</span><span class="o">.</span><span class="na">exact</span><span class="o">(</span><span class="n">myUrl</span><span class="o">,</span> <span class="k">new</span> <span class="n">Column</span><span class="o">(</span><span class="s">"ref"</span><span class="o">))).</span><span class="na">build</span><span class="o">();</span>
      <span class="kt">int</span> <span class="n">numRefs</span> <span class="o">=</span> <span class="n">Iterables</span><span class="o">.</span><span class="na">size</span><span class="o">(</span><span class="n">refScanner</span><span class="o">);</span>

      <span class="c1">// Do something interesting with count.  This is not interesting, but keeps the example short.</span>
      <span class="n">tx</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">myUrl</span><span class="o">,</span> <span class="n">DOC_REF_COUNT_COL</span><span class="o">,</span> <span class="n">numRefs</span> <span class="o">+</span> <span class="s">""</span><span class="o">);</span>
    <span class="o">});</span>
  <span class="o">}</span>

  <span class="cm">/**
   * Compute the change in a documents URLs and propagate those to other documents.
   */</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ContentObserver</span> <span class="kd">implements</span> <span class="n">StringObserver</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">TransactionBase</span> <span class="n">tx</span><span class="o">,</span> <span class="n">String</span> <span class="n">myUrl</span><span class="o">,</span> <span class="n">Column</span> <span class="n">col</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

      <span class="c1">// Retrieve the new and current document content.</span>
      <span class="n">Map</span><span class="o">&lt;</span><span class="n">Column</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">colVals</span> <span class="o">=</span> <span class="n">tx</span><span class="o">.</span><span class="na">gets</span><span class="o">(</span><span class="n">myUrl</span><span class="o">,</span> <span class="n">DOC_CURR_COL</span><span class="o">,</span> <span class="n">DOC_NEW_COL</span><span class="o">);</span>

      <span class="n">String</span> <span class="n">newContent</span> <span class="o">=</span> <span class="n">colVals</span><span class="o">.</span><span class="na">getOrDefault</span><span class="o">(</span><span class="n">DOC_NEW_COL</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>
      <span class="n">String</span> <span class="n">currContent</span> <span class="o">=</span> <span class="n">colVals</span><span class="o">.</span><span class="na">getOrDefault</span><span class="o">(</span><span class="n">DOC_CURR_COL</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>

      <span class="c1">// Extract the URLs in the new and current document content.</span>
      <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">newUrls</span> <span class="o">=</span> <span class="n">extractUrls</span><span class="o">(</span><span class="n">newContent</span><span class="o">);</span>
      <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">currUrls</span> <span class="o">=</span> <span class="n">extractUrls</span><span class="o">(</span><span class="n">currContent</span><span class="o">);</span>

      <span class="c1">// For URLs that only exist in new content, update the document they reference.</span>
      <span class="n">Sets</span><span class="o">.</span><span class="na">difference</span><span class="o">(</span><span class="n">newUrls</span><span class="o">,</span> <span class="n">currUrls</span><span class="o">).</span><span class="na">forEach</span><span class="o">(</span><span class="n">url</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">tx</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="k">new</span> <span class="n">Column</span><span class="o">(</span><span class="s">"ref"</span><span class="o">,</span> <span class="n">myUrl</span><span class="o">),</span> <span class="s">""</span><span class="o">);</span>
        <span class="n">tx</span><span class="o">.</span><span class="na">setWeakNotification</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">DOC_URL_CHANGE</span><span class="o">);</span>
      <span class="o">});</span>

      <span class="c1">// For URLs that are no longer present, update the document they reference.</span>
      <span class="n">Sets</span><span class="o">.</span><span class="na">difference</span><span class="o">(</span><span class="n">currUrls</span><span class="o">,</span> <span class="n">newUrls</span><span class="o">).</span><span class="na">forEach</span><span class="o">(</span><span class="n">url</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">tx</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="k">new</span> <span class="n">Column</span><span class="o">(</span><span class="s">"ref"</span><span class="o">,</span> <span class="n">myUrl</span><span class="o">));</span>
        <span class="n">tx</span><span class="o">.</span><span class="na">setWeakNotification</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">DOC_URL_CHANGE</span><span class="o">);</span>
      <span class="o">});</span>

      <span class="c1">// Update the current document content.</span>
      <span class="n">tx</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">myUrl</span><span class="o">,</span> <span class="n">DOC_CURR_COL</span><span class="o">,</span> <span class="n">newContent</span><span class="o">);</span>
      <span class="n">tx</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">myUrl</span><span class="o">,</span> <span class="n">DOC_NEW_COL</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">extractUrls</span><span class="o">(</span><span class="n">String</span> <span class="n">newContent</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// TODO implement extracting URLs from content</span>
      <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Before initializing a Fluo App, the ObserverProvider above would be added to configuration as follows.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FluoConfiguration</span> <span class="n">fluoConf</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">fluoConf</span><span class="o">.</span><span class="na">setObserverProvider</span><span class="o">(</span><span class="n">AppObserverProvider</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="c1">// initialize Fluo app using fluoConf</span>
</code></pre></div></div>

<p>The old API is still present but has been deprecated and may be removed in the future.</p>

<h3 id="improved-fluo-scalability">Improved Fluo scalability</h3>

<p>In the previous release each worker scanned the entire table looking for notifications that hashed
to it.  This strategy for finding notifications is O(N*W) where  N is the number of notification and
W is the number of workers.</p>

<p>For <a href="https://github.com/apache/incubator-fluo/issues/500">#500</a> a different strategy was used to find notifications.  Workers divide themselves into
groups and each group scans a subset of the table for notifications.  Every worker in a group scans
the groups entire subset of a table  looking for notifications that hash to it. The new strategy results
in O(N*G) work where N is the number of notifications and G is the group size.  By default the group
size is 7, but this is configurable.  The group size may need to be increased if portion of a table
is popular and assigned to one group that can not processes it.</p>

<p>To compare the old and new ways assume we have 10<sup>9</sup> notifications and 100 workers.  The
old method would have scanned 10<sup>11</sup> entries to to find all notifications.  Assuming a group
size of 7, the new strategy scans 7 * 10<sup>9</sup> entries to find all notifications.  A
nice feature of the new strategy is that the amount of scanning is independent of the number of workers.
For the old strategy if the number of workers increases by factor of 10, then the amount scanning
will increase by a factor of 10.  So for 1,000 workers the old strategy would scan
10<sup>12</sup> entries to find all notifications.  The new strategy will still only scan 7 *
10<sup>9</sup> entries with 1,000 workers.</p>

<h3 id="improved-bytes">Improved Bytes</h3>

<p>Fluo’s API has an immutable wrapper for a byte array.  Multiple improvements were made to this byte
wrapper.</p>

<ul>
  <li><code class="highlighter-rouge">startsWith(Bytes)</code> and <code class="highlighter-rouge">endsWith(Bytes)</code> methods were added in <a href="https://github.com/apache/incubator-fluo/issues/823">#823</a></li>
  <li>A <code class="highlighter-rouge">copyTo(byte[])</code> method was added for <a href="https://github.com/apache/incubator-fluo/issues/827">#827</a></li>
  <li>Internal performance improvements were made in <a href="https://github.com/apache/incubator-fluo/issues/826">#826</a> and <a href="https://github.com/apache/incubator-fluo/issues/799">#799</a></li>
</ul>

<h3 id="improved-spark-integration">Improved Spark integration</h3>

<p>For <a href="https://github.com/apache/incubator-fluo/issues/813">#813</a> improvements were made that allow easy passing of FluoConfiguration objects to remote Spark
processes.</p>

<h2 id="testing">Testing</h2>

<p>Long runs of <a href="https://lists.apache.org/thread.html/2381a0b315e8e81871b6caf41e2f1462aa513b9cb24d3ddd92724674@%3Cdev.fluo.apache.org%3E">Stresso</a> and <a href="https://twitter.com/ApacheFluo/status/870045298424512512">Webindex</a> were successfully completed on EC2 using multiple nodes.</p>


</div>

<div>
  <p class="text-muted">View all releases in the <a href="/releases/">archive</a></p>
</div>

          </div>
      </div>
      <div class="row">
        <div class="col-sm-12 center-block">
          <footer>
            <hr/>
            <p>
            <a href="https://www.apache.org/foundation/contributing"><img
              src="https://www.apache.org/images/SupportApache-small.png"
              id="asf-logo" height="100" alt="Apache"/></a>
            </p>
            <p>
            Copyright &copy; 2020 <a
              href="https://www.apache.org">The&nbsp;Apache&nbsp;Software&nbsp;Foundation</a>.
            Licensed under the <a
              href="https://www.apache.org/licenses/">Apache&nbsp;License,&nbsp;Version&nbsp;2.0</a>
            </p>
            <p>
            Apache®, the names of Apache projects and their logos, and the multicolor feather
            logo are registered trademarks or trademarks of The Apache Software Foundation
            in the United States and/or other countries.
            </p>
          </footer>
        </div>
      </div>
    </div>
  </body>
</html>
